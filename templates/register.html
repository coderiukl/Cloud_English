{% extends "base.html" %}
{% load static %}
{% block title %}Register - English Learning{% endblock title %}

{% block content %}
<div class="container mt-5 pt-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <h2 class="text-center mb-4">Register</h2>
        <form id="register-form">
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" id="name" class="form-control" placeholder="Enter your name" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" id="password" class="form-control" placeholder="Enter password" required>
          </div>
          <div class="mb-3">
            <label for="password2" class="form-label">Confirm Password</label>
            <input type="password" id="password2" class="form-control" placeholder="Re-enter password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100 rounded-pill fw-semibold">Register</button>
        </form>
        <p class="mt-3 text-center">
          Already have an account? <a href="{% url 'login_page' %}">Login here</a>
        </p>
      </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('register-form');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const password2 = document.getElementById('password2').value;

            const response = await fetch('/api/auth/register/', {
                method: 'POST',
                headers: {
                    'Content-Type':'application/json',
                },
                body: JSON.stringify({
                    name,
                    email,
                    password,
                    password2
                })
            });

            const data = await response.json();

            if (response.ok) {
                alert('Đăng ký thành công! Mời bạn đăng nhập.');
                window.location.href = '/login/';
            } else {
                let errorMsg = '';
                for (const key in data) {
                    errorMsg += `${key}: ${data[key]}\n`;
                }
                alert('Lỗi đăng ký:\n' + errorMsg);
            }
        });
    });
</script>
{% endblock content %}