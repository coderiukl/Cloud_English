{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 id="topic-name"></h2>
    <h4 id="subtopic-title"></h4>

    <!-- Phần hiển thị các bài tập -->
    <div id="exercises-container" class="row"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const topicSlug = "{{ topic.slug }}";
        const subtopicSlug = "{{ subtopic.slug }}"; // Thêm thông tin về subtopic

        // Fetch dữ liệu từ API
        fetch(`/api/topics/${topicSlug}/subtopics/${subtopicSlug}/listen-and-type/`)
            .then(response => response.json())
            .then(data => {
                // Hiển thị tên topic và subtopic
                document.getElementById('topic-name').textContent = data.topic.name;
                document.getElementById('subtopic-title').textContent = data.subtopic.title;

                const exercisesContainer = document.getElementById('exercises-container');

                data.exercises.forEach(exercise => {
                    const exerciseCard = document.createElement('div');
                    exerciseCard.classList.add('col-md-4', 'mb-3');  // Bootstrap class cho 3 cột

                    exerciseCard.innerHTML = `
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <audio controls>
                                    <source src="${exercise.audioSrc}" type="audio/mp3">
                                    Your browser does not support the audio element.
                                </audio>
                                <input type="text" class="form-control mt-2" placeholder="Type what you hear">
                                <small class="form-text text-muted">${exercise.correct_text}</small>
                            </div>
                        </div>
                    `;

                    exercisesContainer.appendChild(exerciseCard);
                });
            })
            .catch(error => console.error('Error fetching exercise data:', error));
    });
</script>
{% endblock %}
